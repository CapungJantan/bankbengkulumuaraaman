<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Babe Maman - Simulasi Kredit</title>
    <link rel="stylesheet" href="style.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  </head>

  <body>
    <div class="container">
      <form id="form" class="container m-4 pl-4" method="POST">
        <div class="halaman-form1" id="form1">
          <header>SIMULASI</header>
          <div class="separator">
              <div class="line"></div>
          </div>
          <div class="input-box"> <!--Nama Lengkap----->
            <div class="input-field">
              <input
                class="input"
                required
                type="text"
                placeholder="Nama Lengkap"
                name="Nama Lengkap"
                oninvalid="this.setCustomValidity('Isi Nama Lengkap')" oninput="this.setCustomValidity('')"
              />
              <i class='bx bxs-user'></i>
            </div>
          </div>
          <div class="input-box"> <!--Nomor Handphone-->
            <div class="input-field">
              <input
                class="input"
                type="text"
                placeholder="Nomor Handphone"
                name="Nomor Handphone"
              />
              <i class='bx bxs-phone'></i>
            </div>
          </div>
          <div class="input-box"> <!--Instansi--------->
            <div class="input-field">
              <input
                class="input"
                type="text"
                placeholder="Instansi"
                name="Instansi"
              />
              <i class='bx bxs-buildings'></i>
            </div>
          </div>
          <div class="input-box"> <!--Jabatan---------->
            <div class="input-field">
              <div class="flex">
                <div class="submit"><input type="button" name="submit" value="Jabatan" full-width/></div>
                <select name="Jabatan" class="input-jabatan" id="Jabatan" onchange="resetjangkawaktu()">
                  <option value="0" disabled selected hidden>Pilih disini</option>
                  <option value="1">ASN Struktural</option>
                  <option value="2">ASN Fungsional</option>
                  <option value="3">ASN PPPK</option>
                </select>
              </div>
              <i class='bx bxs-bookmarks'></i>
            </div>
          </div>
          <div class="input-box"> <!--Gaji Bersih------>
            <div class="input-field">
              <input
                class="input"
                type="text"
                placeholder="Gaji Bersih"
                name="Gaji"
                id="rupiah"
                max="9999999999999"
                maxlength="11"
              />
              <i class='bx bxs-coin-stack'></i>
            </div>
          </div>
          <div class="input-box"> <!--Tanggal Lahir---->
            <div class="input-field">
              <div class="flex">
              <div class="submit"><input type="button" name="submit" value="Tanggal Lahir"/></div>
              <div class="block"><input type="text" name="date" id="date" placeholder="dd" required minlength="1" maxlength="2" oninvalid="this.setCustomValidity('Isi Tanggal Lahir')" oninput="this.setCustomValidity('')"/></div>
              <div class="block"><input type="text" name="month" id="month" placeholder="mm" required minlength="1" maxlength="2" oninvalid="this.setCustomValidity('Isi Bulan Lahir')" oninput="this.setCustomValidity('')"/></div>
              <div class="block"><input type="text" name="year" id="year" placeholder="yyyy" required minlength="4" maxlength="4" oninvalid="this.setCustomValidity('Isi Tahun lahir')" oninput="this.setCustomValidity('')"/></div>
              <i class='bx bxs-calendar'></i>
              </div>
            </div>
          </div>
          <div class="other"><!--Lain-Lain------------->
            <div id="age"></div>
          </div>
          <div class="separator">
            <div class="line"></div>
          </div>
        </div>
        <div class="halaman-form2" id="form2">
          <div class="input-label">
            <div class="label-field"><Label>Nominal Plafond</Label></div>
            <div class="label-field"><Label>Jangka Waktu</Label></div>
            <div class="label-field"><Label>Status Nasabah</Label></div>
          </div>
          <div class="input-box2"> <!--Pf dan Jw------->
            <select id="pf" name="Plafond" class="input-currency">
              <option value="" disabled selected hidden>Nominal</option>
            </select>
            <select id="jw" name="Jangka Waktu" class="input-jw">
              <option value="" disabled selected hidden>Bulan</option>
            </select>
            <div class="radio-group"> <!--Status Pinjaman---------->
              <div class="radio">
                <input type="radio" name="Status Pinjaman" value="Baru" id="st">
                <div class="radio-tile">
                  <label for="st">Baru</label>
                </div>
              </div>
              <div class="radio">
                <input type="radio" name="Status Pinjaman" value="Top-Up" id="st">
                <div class="radio-tile">
                  <label for="st">Top-Up</label>
                </div>
              </div>
              <div class="radio">
                <input type="radio" name="Status Pinjaman" value="Bank Lain" id="st">
                <div class="radio-tile">
                  <label for="st">Bank Lain</label>
                </div>  
              </div>
            </div>
          </div>
        </div>
        <div class="halaman-hasil"> <!--Hasil---------->
          <button class="button" type="submit" id="submit-button">PROSES</button>
          <header>Hasil Perhitungan</header>
          <br>
          <div class="separator">
            <div class="line"></div>
          </div>
          <br>
          <h3> </h3>
          <div class="hasil">
            <table class="hasil">
              <tr>
                <td>Plafond</td>
                <td>=</td>
                <td align="right" id="nom"></td>
              </tr>
              <tr>
                <td>Jangka Waktu</td>
                <td>=</td>
                <td align="right"  id="jwz"></td>
              </tr>
              <tr>
                <td>Bunga</td>
                <td>=</td>
                <td align="right"  id="bgs"></td>
              </tr>
              <tr>
                <td>Angsuran</td>
                <td>=</td>
                <td align="right"  id="ags"></td>
              </tr>
              <tr>
                <td>Status Pinjaman</td>
                <td>=</td>
                <td align="right"  id="sts"></td>
              </tr>
            </table>
          </div>
        </div>
        <div 
      id="message"
      style="
        display: none;
        margin: 20px;
        font-weight: bold;
        color: blue;
        padding: 8px;
        background-color: beige;
        border-radius: 4px;
        border-color: aquamarine;
      ">
        </div> <!--Pesan Proses-------------------------->
      </form>
    </div>


    <!------------------------------------------------------------------------------------------------------------------------------------------------------------------->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js'></script>
    <!-- hitung usia ------------------------------------------------------------------------->
    <script>
      function age() {
          var d1 = document.getElementById('date').value;
          var m1 = document.getElementById('month').value;
          var y1 = document.getElementById('year').value;

          var date = new Date();
          var d2 = date.getDate();
          var m2 = 1 + date.getMonth();
          var y2 = date.getFullYear();
          var month = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

          if(d1 > d2){
            d2 = d2 + month[m2 - 1];
            m2 = m2 - 1;
          }
          if(m1 > m2){
            m2 = m2 + 12;
            y2 = y2 - 1;
          }
          var d = d2 - d1;
          var m = m2 - m1;
          var y = ((y2 - y1)*12)+m;

          document.getElementById('age').innerHTML = y + ' Bulan';
          document.getElementById('age').value = y;
          generatejangkawaktu(y)
      }
      document.getElementById('date').addEventListener('input', age);
      document.getElementById('month').addEventListener('input', age);
      document.getElementById('year').addEventListener('input', age);
    </script>
    <!-- plafond & jangka waktu -------------------------------------------------------------->
    <script>
      function generateplafond() {
          var select = document.getElementById("pf");
          var nilaiawal = 1000000;
          var nilaiakhir = 500000000;
          var kelipatan = 1000000;

          for (var i = nilaiawal; i <= nilaiakhir; i += kelipatan) {
            var option = document.createElement("option");
            option.value = i;
            option.text = "Rp " + formatNumber(i);
            select.appendChild(option);
          }
        }
      function formatNumber(number) {
          return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
      generateplafond();
      function generatejangkawaktu(y) {
        var select = document.getElementById("jw");
        var jabatan = document.getElementById("Jabatan").value;
        if (jabatan === "1") {
            var jwmax = 180;
          } else if (jabatan === "2") {
            var jwmax = 180;
          } else if (jabatan === "3") {
            var jwmax = 60;
        }
        var jwawal = 1;
        var jwakhir   = 696 - y; if (jwakhir > jwmax) {jwakhir = jwmax;}
        var kelipatan  = 1; 

        for (var i = jwawal; i <= jwakhir; i += kelipatan) {
          var option = document.createElement("option");
          option.value = i;
          option.text = formatNumber(i) + " Bulan";
          select.appendChild(option);
        }
      }
      generatejangkawaktu(y)
      function resetjangkawaktu() {
        var select = document.getElementById("jw");
        while (select.options.length > 1) {
          select.remove(1);
        }
        select.value ='';
      }
    </script>
    <!-- rumus anuitas ----------------------------------------------------------------------->
    <script>
    function cekParam(pf, jw){
        if(Number.isNaN(pf) &&  Number.isNaN(jw)) 
          return true
        else
          return false
    }

    function hitungAnu(pf, lama) {
      var statuspj = document.querySelector('input[name="Status Pinjaman"]:checked');
      if (statuspj) {
        switch(statuspj.value) {
          case "Baru":
            var bg = 10.45;
          break;
          case "Top-Up":
            var bg = 10.30;
          break;
          case "Bank Lain":
            var bg = 10.45;
          break;
        }
      }

      var bb = (bg/100)/12; 
      var db = lama;
      var pb = (1 + bb) ** db; 
      var out = (pf) * ((bb * pb) / (pb - 1));
      return Number(out.toFixed(2)).toLocaleString('id');
    }

    $("#submit-button").click(function(){
        $("#nom").empty();
        $("#jwz").empty();
        $("#bgs").empty();
        $("#ags").empty();
        $("#sts").empty();

        var pfz = $("#pf").val();
        var jwz = $("#jw").val();
        var sts = document.querySelector('input[name="Status Pinjaman"]:checked').value;
        if (sts) {
          switch(sts) {
            case "Baru":
              var bgs = "10.45 %";
            break;
            case "Top-Up":
              var bgs = "10.30 %";
            break;
            case "Bank Lain":
              var bgs = "10.45 %";
            break;
          }
        }

        console.log(pf);
        $("#nom").append("Rp " + Number(pfz).toLocaleString('id'));
        $("#jwz").append(Number(jwz) + " Bulan");
        $("#bgs").append(bgs); 
        $("#ags").append("Rp " + hitungAnu(pfz, jwz));
        $("#sts").append(sts);
    });
    </script>
    <!-- currency ---------------------------------------------------------------------------->
    <script type="text/javascript">
      var rupiah =document.getElementById('rupiah');
      rupiah.addEventListener('keyup', function(e){
            rupiah.value = formatRupiah(this.value, 'Rp. ');
        });
      function formatRupiah(angka, prefix){
            var number_string = angka.replace(/[^,\d]/g, '').toString(),
            split             = number_string.split(','),
            sisa              = split[0].length % 3,
            rupiah            = split[0].substr(0, sisa),
            ribuan            = split[0].substr(sisa).match(/\d{3}/gi);

            if(ribuan){
                separator = sisa ? '.' :'';
                rupiah    += separator + ribuan.join('.');
            }

            rupiah = split[1] !=undefined ? rupiah + ',' + split[1] :rupiah;
            return prefix == undefined ? rupiah :(rupiah ? 'Rp ' + rupiah :'');}
    </script>
    <script type="text/javascript">
        var rupiah2 =document.getElementById('pfss');
        rupiah2.addEventListener('keyup', function(e){
            rupiah2.value = formatRupiah2(this.value, '');
        });
        function formatRupiah2(angka, prefix){
            var number_string = angka.replace(/[^,\d]/g, '').toString(),
            split             = number_string.split(','),
            sisa              = split[0].length % 3,
            rupiah2           = split[0].substr(0, sisa),
            ribuan            = split[0].substr(sisa).match(/\d{3}/gi);

            if(ribuan){
                separator = sisa ? '.' :'';
                rupiah2    += separator + ribuan.join('.');
            }

            rupiah2 = split[1] !=undefined ? rupiah2 + ',' + split[1] :rupiah2;
            return prefix == undefined ? rupiah :(rupiah2 ? 'Rp ' + rupiah2 :'');}
    </script>
    <!-- posting ke database ----------------------------------------------------------------->
    <script>
        document.getElementById("form").addEventListener("submit", function (e) {
        e.preventDefault(); // Prevent the default form submission
        document.getElementById("message").textContent = "Sedang Diproses..";
        document.getElementById("message").style.display = "block";
        document.getElementById("submit-button").disabled = true;

        // Collect the form data
        var formData = new FormData(this);
        var keyValuePairs = [];
        for (var pair of formData.entries()) {
        keyValuePairs.push(pair[0] + "=" + pair[1]);
        }

        var formDataString = keyValuePairs.join("&");

        // Send a POST request to your Google Apps Script
        fetch(
        "https://script.google.com/macros/s/AKfycbyHGoaOYn0kaTdYg1aAKNKHPimwvQvJaoogdx25hU3TVNuLQuOHwEidp_D65xBw6Dw/exec",
        {
            redirect: "follow",
            method: "POST",
            body: formDataString,
            headers: {
            "Content-Type": "text/plain;charset=utf-8",},
        }
        )
        .then(function (response) {
          // Check if the request was successful
            if (response) {
              return response; // Assuming your script returns JSON response
            } else {
              throw new Error("Proses Penginputan Gagal, Silahkan Ulangi.");
            }
        })
        .then(function (data) {
            // Display a success message
            document.getElementById("message").textContent = "Proses Berhasil!";
            document.getElementById("message").style.display = "block";
            document.getElementById("message").style.backgroundColor = "blue";
            document.getElementById("message").style.color = "beige";
            document.getElementById("submit-button").disabled = false;
            document.getElementById("form").reset();

            // Display result
            document.getElementById("form").classList.add("active");

            setTimeout(function () {
            document.getElementById("message").textContent = "";
            document.getElementById("message").style.display = "none";}, 2600);
        })
        .catch(function (error) {
            // Handle errors, you can display an error message here
            console.error(error);
            document.getElementById("message").textContent ="Terjadi Kesalahan Dalam Proses, Silahkan Ulangi.";
            document.getElementById("message").style.display = "block";});
        });

    </script>
    <!-- disable ----------------------------------------------------------------------------->
    <script>
      const halamansatu = document.getElementById('form1');
      const halamandua = document.getElementById('form2');
      halamandua.classList.add('disabled');
      halamansatu.addEventListener('input', () => {
        const allFilled = [...halamansatu.querySelectorAll('input[required]')].every(input => input.value.trim() !== '');
        if (allFilled) {
          halamansatu.classList.add('disabled');
          halamandua.classList.remove('disabled');
        } else {
          halamandua.classList.add('disabled');
          halamansatu.classList.remove('disabled');
        }
      });
    </script>
    <!-- max number --------------------------------------------------------------------------
    <script>  
        document.querySelectorAll('input[type="number"]').forEach(input =>{
          input.oninput = () =>{
            if(input.value.length > input.maxLength) input.value = input.value.slice(0, input.maxLength);
          };
        });
    </script>-->
    <!-- text button -------------------------------------------------------------------------
    <script>
      const container = document.querySelector('.container');
      const signupButton = document.querySelector('.signup-section header');
      const loginButton = document.querySelector('.login-section header');

      loginButton.addEventListener('click', () => {
          container.classList.add('active');
      });

      signupButton.addEventListener('click', () => {
          container.classList.remove('active');
      });
    </script>-->
  </body>
</html>
